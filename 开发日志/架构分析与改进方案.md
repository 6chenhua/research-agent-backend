# ğŸ—ï¸ é¡¹ç›®æ¶æ„åˆ†æä¸æ”¹è¿›æ–¹æ¡ˆ

## ğŸ“Š ä¸€ã€å½“å‰æ¶æ„åˆ†æ

### âœ… å·²å…·å¤‡çš„åŸºç¡€ç»“æ„
1. **APIè·¯ç”±å±‚** - chat.py, graph.py, papers.py
2. **æœåŠ¡å±‚** - agent_service.py, graph_service.py, ingest_service.py, search_service.py, pdf_parser.py
3. **æ•°æ®æ¨¡å‹å±‚** - chat_models.py, graph_models.py, paper_models.py
4. **æ ¸å¿ƒé…ç½®** - config.py, graphiti_client.py
5. **å¼‚æ­¥ä»»åŠ¡** - worker.py, ingest_tasks.py
6. **å·¥å…·å±‚** - text_splitter.py

### âŒ ç¼ºå¤±çš„å…³é”®åŠŸèƒ½æ¨¡å—

æ ¹æ®functional-requirements.mdçš„éœ€æ±‚ï¼Œå½“å‰æ¶æ„ç¼ºå¤±ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

#### 1. **å¤–éƒ¨æ•°æ®æºé›†æˆ**
- âŒ arXiv APIé›†æˆ
- âŒ Semantic Scholar APIé›†æˆ
- âŒ å¤–éƒ¨æœç´¢fallbackæœºåˆ¶

#### 2. **å®ä½“Schemaå®šä¹‰**
- âŒ è‡ªå®šä¹‰å®ä½“ç±»å‹ï¼ˆPaperã€Methodã€Taskã€Datasetã€Metricã€Authorã€Institutionã€Conceptï¼‰
- âŒ è‡ªå®šä¹‰å…³ç³»ç±»å‹ï¼ˆPROPOSESã€EVALUATES_ONã€IMPROVES_OVERã€CITESç­‰ï¼‰
- âŒ Pydantic Schemaå®šä¹‰

#### 3. **ç”¨æˆ·ä¸ªæ€§åŒ–ç³»ç»Ÿ**
- âŒ ç”¨æˆ·ç”»åƒæœåŠ¡ï¼ˆuser_profile_service.pyï¼‰
- âŒ ç”¨æˆ·å…´è¶£embedding
- âŒ ç”¨æˆ·ç ”ç©¶ç¤¾åŒºç®¡ç†
- âŒ ä¸ªæ€§åŒ–æ¨èå¼•æ“

#### 4. **Communityç®¡ç†**
- âŒ Communityæ£€æµ‹æœåŠ¡
- âŒ Communityæ›´æ–°ç­–ç•¥
- âŒ CommunityæŸ¥è¯¢API

#### 5. **åŒå›¾è°±ç®¡ç†**
- âŒ ç”¨æˆ·å›¾è°±ï¼ˆuser_graphï¼‰vs å…¬å…±å›¾è°±ï¼ˆglobal_graphï¼‰çš„æ˜ç¡®åŒºåˆ†
- âŒ Namespaceç®¡ç†ï¼ˆgroup_idï¼‰
- âŒ å›¾è°±åˆ‡æ¢å’Œèšåˆç­–ç•¥

#### 6. **Agentå·¥å…·ç³»ç»Ÿ**
- âŒ Toolå®šä¹‰æ¡†æ¶
- âŒ Toolè°ƒç”¨æœºåˆ¶ï¼ˆgraph_queryã€external_searchã€pdf_parseç­‰ï¼‰
- âŒ Tool orchestration

#### 7. **å†å²ç®¡ç†**
- âŒ èŠå¤©å†å²å­˜å‚¨å’ŒæŸ¥è¯¢
- âŒ è®ºæ–‡é˜…è¯»å†å²
- âŒ ç”¨æˆ·è¡Œä¸ºè®°å½•

#### 8. **å¯è§†åŒ–API**
- âŒ å›¾è°±æ•°æ®å¯¼å‡ºAPI
- âŒ ç¤¾åŒºèšç±»å¯è§†åŒ–
- âŒ å…³ç³»å›¾æŸ¥è¯¢

#### 9. **è®ºæ–‡å¯¹æ¯”åŠŸèƒ½**
- âŒ å¤šè®ºæ–‡å¯¹æ¯”æœåŠ¡
- âŒ è®ºæ–‡å…³ç³»åˆ†æ

#### 10. **é«˜çº§å›¾è°±æ“ä½œ**
- âŒ NeighborsæŸ¥è¯¢
- âŒ Multi-hopéå†
- âŒ ç»“æ„åŒ–æ£€ç´¢ï¼ˆæŒ‰schemaï¼‰

---

## ğŸ”§ äºŒã€æ¶æ„æ”¹è¿›æ–¹æ¡ˆ

### ğŸ“ æ”¹è¿›åçš„å®Œæ•´ç›®å½•ç»“æ„

```
backend/
â”œâ”€â”€ main.py
â”œâ”€â”€ run.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ .env.example
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.py                    # å¯¹è¯API
â”‚   â”‚   â”‚   â”œâ”€â”€ graph.py                   # å›¾è°±æŸ¥è¯¢API
â”‚   â”‚   â”‚   â”œâ”€â”€ papers.py                  # è®ºæ–‡API
â”‚   â”‚   â”‚   â”œâ”€â”€ users.py                   # æ–°å¢ï¼šç”¨æˆ·API
â”‚   â”‚   â”‚   â”œâ”€â”€ history.py                 # æ–°å¢ï¼šå†å²è®°å½•API
â”‚   â”‚   â”‚   â”œâ”€â”€ visualization.py           # æ–°å¢ï¼šå¯è§†åŒ–API
â”‚   â”‚   â”‚   â”œâ”€â”€ recommendations.py         # æ–°å¢ï¼šæ¨èAPI
â”‚   â”‚   â”‚   â””â”€â”€ communities.py             # æ–°å¢ï¼šç¤¾åŒºAPI
â”‚   â”‚   â””â”€â”€ dependencies/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ auth.py                    # ç”¨æˆ·è®¤è¯ä¾èµ–
â”‚   â”‚       â””â”€â”€ services.py                # æœåŠ¡ä¾èµ–æ³¨å…¥
â”‚   â”‚
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py                      # âœ… å·²æœ‰
â”‚   â”‚   â”œâ”€â”€ graphiti_client.py             # âœ… å·²æœ‰ï¼ˆéœ€å®Œå–„ï¼‰
â”‚   â”‚   â”œâ”€â”€ logging.py                     # æ–°å¢ï¼šæ—¥å¿—é…ç½®
â”‚   â”‚   â”œâ”€â”€ errors.py                      # æ–°å¢ï¼šè‡ªå®šä¹‰å¼‚å¸¸
â”‚   â”‚   â”œâ”€â”€ security.py                    # æ–°å¢ï¼šå®‰å…¨è®¤è¯
â”‚   â”‚   â””â”€â”€ constants.py                   # æ–°å¢ï¼šå¸¸é‡å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ agent_service.py               # âœ… å·²æœ‰ï¼ˆéœ€å®Œå–„ï¼‰
â”‚   â”‚   â”œâ”€â”€ graph_service.py               # âœ… å·²æœ‰ï¼ˆéœ€å®Œå–„ï¼‰
â”‚   â”‚   â”œâ”€â”€ search_service.py              # âœ… å·²æœ‰ï¼ˆéœ€å®Œå–„ï¼‰
â”‚   â”‚   â”œâ”€â”€ ingest_service.py              # âœ… å·²æœ‰ï¼ˆéœ€å®Œå–„ï¼‰
â”‚   â”‚   â”œâ”€â”€ pdf_parser.py                  # âœ… å·²æœ‰
â”‚   â”‚   â”œâ”€â”€ external_search_service.py     # æ–°å¢ï¼šå¤–éƒ¨æœç´¢
â”‚   â”‚   â”œâ”€â”€ user_profile_service.py        # æ–°å¢ï¼šç”¨æˆ·ç”»åƒ
â”‚   â”‚   â”œâ”€â”€ community_service.py           # æ–°å¢ï¼šç¤¾åŒºç®¡ç†
â”‚   â”‚   â”œâ”€â”€ history_service.py             # æ–°å¢ï¼šå†å²ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ recommendation_service.py      # æ–°å¢ï¼šæ¨èå¼•æ“
â”‚   â”‚   â”œâ”€â”€ visualization_service.py       # æ–°å¢ï¼šå¯è§†åŒ–
â”‚   â”‚   â”œâ”€â”€ comparison_service.py          # æ–°å¢ï¼šè®ºæ–‡å¯¹æ¯”
â”‚   â”‚   â””â”€â”€ namespace_service.py           # æ–°å¢ï¼šå›¾è°±å‘½åç©ºé—´ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ chat_models.py                 # âœ… å·²æœ‰
â”‚   â”‚   â”œâ”€â”€ graph_models.py                # âœ… å·²æœ‰ï¼ˆéœ€å®Œå–„ï¼‰
â”‚   â”‚   â”œâ”€â”€ paper_models.py                # âœ… å·²æœ‰ï¼ˆéœ€å®Œå–„ï¼‰
â”‚   â”‚   â”œâ”€â”€ user_models.py                 # æ–°å¢ï¼šç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ history_models.py              # æ–°å¢ï¼šå†å²æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ community_models.py            # æ–°å¢ï¼šç¤¾åŒºæ¨¡å‹
â”‚   â”‚   â””â”€â”€ recommendation_models.py       # æ–°å¢ï¼šæ¨èæ¨¡å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/                           # æ–°å¢ï¼šGraphitiå®ä½“Schema
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ entities.py                    # å®ä½“ç±»å‹å®šä¹‰ï¼ˆPaperã€Methodç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ relations.py                   # å…³ç³»ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ validators.py                  # SchemaéªŒè¯å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ tools/                             # æ–°å¢ï¼šAgentå·¥å…·ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py                        # ToolåŸºç±»
â”‚   â”‚   â”œâ”€â”€ graph_query_tool.py            # å›¾è°±æŸ¥è¯¢å·¥å…·
â”‚   â”‚   â”œâ”€â”€ external_search_tool.py        # å¤–éƒ¨æœç´¢å·¥å…·
â”‚   â”‚   â”œâ”€â”€ pdf_parse_tool.py              # PDFè§£æå·¥å…·
â”‚   â”‚   â”œâ”€â”€ paper_compare_tool.py          # è®ºæ–‡å¯¹æ¯”å·¥å…·
â”‚   â”‚   â””â”€â”€ tool_registry.py               # å·¥å…·æ³¨å†Œå™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ tasks/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ worker.py                      # âœ… å·²æœ‰
â”‚   â”‚   â”œâ”€â”€ ingest_tasks.py                # âœ… å·²æœ‰
â”‚   â”‚   â”œâ”€â”€ community_tasks.py             # æ–°å¢ï¼šç¤¾åŒºæ£€æµ‹ä»»åŠ¡
â”‚   â”‚   â”œâ”€â”€ arxiv_sync_tasks.py            # æ–°å¢ï¼šarXivåŒæ­¥ä»»åŠ¡
â”‚   â”‚   â””â”€â”€ profile_update_tasks.py        # æ–°å¢ï¼šç”¨æˆ·ç”»åƒæ›´æ–°ä»»åŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ text_splitter.py               # âœ… å·²æœ‰
â”‚   â”‚   â”œâ”€â”€ file_utils.py                  # æ–°å¢ï¼šæ–‡ä»¶æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ embedding_utils.py             # æ–°å¢ï¼šå‘é‡åŒ–å·¥å…·
â”‚   â”‚   â”œâ”€â”€ graph_utils.py                 # æ–°å¢ï¼šå›¾è°±æ“ä½œå·¥å…·
â”‚   â”‚   â””â”€â”€ time_utils.py                  # æ–°å¢ï¼šæ—¶é—´å·¥å…·
â”‚   â”‚
â”‚   â””â”€â”€ integrations/                      # æ–°å¢ï¼šå¤–éƒ¨æœåŠ¡é›†æˆ
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ arxiv_client.py                # arXiv APIå®¢æˆ·ç«¯
â”‚       â”œâ”€â”€ semantic_scholar_client.py     # Semantic Scholarå®¢æˆ·ç«¯
â”‚       â””â”€â”€ llm_client.py                  # LLMå®¢æˆ·ç«¯å°è£…
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_graph.py
â”‚   â”œâ”€â”€ test_chat.py
â”‚   â”œâ”€â”€ test_papers.py
â”‚   â”œâ”€â”€ test_agent.py
â”‚   â”œâ”€â”€ test_tools.py
â”‚   â””â”€â”€ test_integrations.py
â”‚
â””â”€â”€ scripts/                               # æ–°å¢ï¼šç»´æŠ¤è„šæœ¬
    â”œâ”€â”€ init_db.py                         # åˆå§‹åŒ–æ•°æ®åº“
    â”œâ”€â”€ migrate_schema.py                  # Schemaè¿ç§»
    â””â”€â”€ rebuild_communities.py             # é‡å»ºç¤¾åŒº
```

---

## ğŸ¯ ä¸‰ã€æ ¸å¿ƒæ”¹è¿›ç‚¹è¯¦è§£

### 1. **åŒå›¾è°±æ¶æ„ï¼ˆNamespace Managementï¼‰**

**è®¾è®¡åŸåˆ™**ï¼š
- ä½¿ç”¨Graphitiçš„`group_id`æœºåˆ¶å®ç°å‘½åç©ºé—´éš”ç¦»
- `global`ï¼šå…¬å…±ç§‘ç ”å›¾è°±ï¼ˆæ‰€æœ‰ç”¨æˆ·å…±äº«ï¼‰
- `user:<user_id>`ï¼šç”¨æˆ·ä¸ªäººå›¾è°±ï¼ˆç§æœ‰ï¼‰

**å®ç°æ–¹å¼**ï¼š
```python
# app/services/namespace_service.py
class NamespaceService:
    def get_user_namespace(self, user_id: str) -> str:
        return f"user:{user_id}"
    
    def get_global_namespace(self) -> str:
        return "global"
    
    async def search_with_fallback(self, query: str, user_id: str):
        # 1. ä¼˜å…ˆæœç´¢ç”¨æˆ·å›¾è°±
        user_results = await graphiti.search(
            query, 
            group_id=self.get_user_namespace(user_id)
        )
        
        # 2. ä¸è¶³åˆ™æœç´¢å…¨å±€å›¾è°±
        if len(user_results) < threshold:
            global_results = await graphiti.search(
                query,
                group_id=self.get_global_namespace()
            )
            
        # 3. ä»ä¸è¶³åˆ™è§¦å‘å¤–éƒ¨æœç´¢
        if len(user_results + global_results) < threshold:
            external_results = await external_search_service.search(query)
```

### 2. **Agentå·¥å…·ç³»ç»Ÿï¼ˆTool Frameworkï¼‰**

**è®¾è®¡åŸåˆ™**ï¼š
- æ¯ä¸ªå·¥å…·æ˜¯ç‹¬ç«‹çš„å¯è°ƒç”¨å•å…ƒ
- ç»Ÿä¸€çš„Toolæ¥å£
- Agenté€šè¿‡tool_registryåŠ¨æ€è°ƒç”¨

**ToolåŸºç±»**ï¼š
```python
# app/tools/base.py
from abc import ABC, abstractmethod
from pydantic import BaseModel

class ToolInput(BaseModel):
    pass

class ToolOutput(BaseModel):
    pass

class BaseTool(ABC):
    name: str
    description: str
    
    @abstractmethod
    async def execute(self, input: ToolInput) -> ToolOutput:
        pass
```

**æ ¸å¿ƒTools**ï¼š
1. `GraphQueryTool` - å›¾è°±æœç´¢ï¼ˆhybrid search / node distance rerankingï¼‰
2. `ExternalSearchTool` - å¤–éƒ¨è®ºæ–‡æœç´¢ï¼ˆarXiv + Semantic Scholarï¼‰
3. `PDFParseTool` - PDFè§£æå’Œæ‘„å…¥
4. `PaperCompareTool` - è®ºæ–‡å¯¹æ¯”
5. `CommunityQueryTool` - ç¤¾åŒºæŸ¥è¯¢
6. `UserProfileTool` - ç”¨æˆ·ç”»åƒæŸ¥è¯¢

### 3. **å®ä½“Schemaå®šä¹‰ï¼ˆCustom Entity Typesï¼‰**

æ ¹æ®Graphiti APIæ–‡æ¡£ï¼Œä½¿ç”¨Pydanticå®šä¹‰è‡ªå®šä¹‰å®ä½“ç±»å‹ï¼š

```python
# app/schemas/entities.py
from pydantic import BaseModel, Field
from typing import Optional, List
from datetime import datetime

class PaperEntity(BaseModel):
    """è®ºæ–‡å®ä½“"""
    title: str
    arxiv_id: Optional[str] = None
    doi: Optional[str] = None
    abstract: str
    year: int
    venue: Optional[str] = None
    authors: List[str] = []
    
class MethodEntity(BaseModel):
    """æ–¹æ³•å®ä½“"""
    name: str
    description: str
    category: Optional[str] = None  # e.g., "transformer", "cnn"
    
class DatasetEntity(BaseModel):
    """æ•°æ®é›†å®ä½“"""
    name: str
    description: Optional[str] = None
    domain: Optional[str] = None  # e.g., "vision", "nlp"
    
class TaskEntity(BaseModel):
    """ä»»åŠ¡å®ä½“"""
    name: str
    description: Optional[str] = None
    
class MetricEntity(BaseModel):
    """è¯„ä»·æŒ‡æ ‡å®ä½“"""
    name: str
    value: Optional[float] = None
```

```python
# app/schemas/relations.py
class RelationType:
    PROPOSES = "PROPOSES"  # Paper -> Method
    EVALUATES_ON = "EVALUATES_ON"  # Paper -> Dataset
    SOLVES = "SOLVES"  # Method -> Task
    IMPROVES_OVER = "IMPROVES_OVER"  # Method -> Method
    CITES = "CITES"  # Paper -> Paper
    USES_METRIC = "USES_METRIC"  # Paper -> Metric
    AUTHORED_BY = "AUTHORED_BY"  # Paper -> Author
```

### 4. **ç”¨æˆ·ç”»åƒç³»ç»Ÿï¼ˆUser Profileï¼‰**

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- è‡ªåŠ¨è¿½è¸ªç”¨æˆ·é˜…è¯»è®ºæ–‡
- ç”Ÿæˆç”¨æˆ·å…´è¶£embedding
- è¯†åˆ«ç”¨æˆ·ç ”ç©¶æ–¹å‘
- æ„å»ºç”¨æˆ·ä¸ªäººç¤¾åŒº

**å®ç°**ï¼š
```python
# app/services/user_profile_service.py
class UserProfileService:
    async def update_reading_history(self, user_id: str, paper_id: str):
        """è®°å½•ç”¨æˆ·é˜…è¯»è®ºæ–‡"""
        pass
    
    async def get_user_interests(self, user_id: str) -> List[str]:
        """è·å–ç”¨æˆ·å…´è¶£ä¸»é¢˜"""
        pass
    
    async def get_research_direction(self, user_id: str) -> str:
        """åˆ†æç”¨æˆ·ç ”ç©¶æ–¹å‘"""
        pass
    
    async def build_user_communities(self, user_id: str):
        """ä¸ºç”¨æˆ·æ„å»ºä¸ªäººç ”ç©¶ç¤¾åŒº"""
        await graphiti.build_communities(
            group_id=f"user:{user_id}",
            update_communities=True
        )
```

### 5. **å¤–éƒ¨æœç´¢é›†æˆï¼ˆExternal Searchï¼‰**

**æ”¯æŒçš„æ•°æ®æº**ï¼š
1. arXiv API
2. Semantic Scholar API

**Fallbackæœºåˆ¶**ï¼š
```python
# app/services/external_search_service.py
class ExternalSearchService:
    def __init__(self):
        self.arxiv_client = ArxivClient()
        self.s2_client = SemanticScholarClient()
        
    async def search(self, query: str, max_results: int = 10):
        """å¤–éƒ¨æœç´¢å¹¶è‡ªåŠ¨æ„å»ºå›¾è°±"""
        # 1. æœç´¢arXiv
        papers = await self.arxiv_client.search(query, max_results)
        
        # 2. ä¸‹è½½PDF
        for paper in papers:
            pdf_bytes = await self.arxiv_client.download_pdf(paper.id)
            
            # 3. è‡ªåŠ¨æ‘„å…¥å›¾è°±
            await ingest_service.ingest_pdf(
                pdf_bytes, 
                metadata=paper,
                group_id="global"  # å†™å…¥å…¨å±€å›¾è°±
            )
        
        return papers
```

### 6. **Communityç®¡ç†**

```python
# app/services/community_service.py
class CommunityService:
    async def detect_communities(self, group_id: str):
        """æ£€æµ‹ç¤¾åŒº"""
        await graphiti.build_communities(
            group_id=group_id,
            update_communities=True
        )
    
    async def get_community_summary(self, community_id: str):
        """è·å–ç¤¾åŒºæ‘˜è¦"""
        pass
    
    async def get_user_communities(self, user_id: str):
        """è·å–ç”¨æˆ·çš„ç ”ç©¶ç¤¾åŒº"""
        pass
```

---

## ğŸ“ å››ã€å…³é”®æŠ€æœ¯å†³ç­–

### 1. **å›¾è°±æ‘„å…¥ç­–ç•¥**

**Episodeæ„å»º**ï¼š
- æ¯ä¸ªè®ºæ–‡sectionä½œä¸ºä¸€ä¸ªEpisode
- Episodeç±»å‹ï¼š`Episode.text`
- æ—¶é—´æˆ³ï¼šè®ºæ–‡å‘è¡¨æ—¶é—´

```python
# ä¼ªä»£ç 
for section in paper.sections:
    await graphiti.add_episode(
        name=f"{paper.title} - {section.title}",
        episode_body=section.content,
        source=Episode.text,
        source_description=f"Section from {paper.title}",
        reference_time=paper.published_date,
        group_id=group_id,
        update_communities=False  # æ‰¹é‡æ‘„å…¥å®Œæˆåç»Ÿä¸€æ›´æ–°
    )
```

### 2. **å®ä½“æŠ½å–é…ç½®**

ä½¿ç”¨`excluded_entity_types`é¿å…æå–ä¸éœ€è¦çš„ç±»å‹ï¼š

```python
await graphiti.add_episode(
    ...,
    excluded_entity_types=["Person", "Location", "Organization"]  # åªå…³æ³¨å­¦æœ¯å®ä½“
)
```

### 3. **æœç´¢ç­–ç•¥é€‰æ‹©**

- **å¹¿æ³›æ¢ç´¢**ï¼šä½¿ç”¨Hybrid Searchï¼ˆ`graphiti.search(query)`ï¼‰
- **ç²¾å‡†æŸ¥è¯¢**ï¼šä½¿ç”¨Node Distance Rerankingï¼ˆ`graphiti.search(query, focal_node_uuid)`ï¼‰

### 4. **æ•°æ®æŒä¹…åŒ–**

- **èŠå¤©å†å²**ï¼šä½¿ç”¨SQLite/PostgreSQLå­˜å‚¨
- **ç”¨æˆ·ç”»åƒ**ï¼šå­˜å‚¨åœ¨å…³ç³»æ•°æ®åº“ï¼ŒåŒæ—¶åœ¨å›¾è°±ä¸­æ„å»ºç”¨æˆ·èŠ‚ç‚¹
- **è®ºæ–‡å…ƒæ•°æ®**ï¼šä¼˜å…ˆä½¿ç”¨å›¾è°±ï¼Œè¾…ä»¥å…³ç³»æ•°æ®åº“ç´¢å¼•

---

## ğŸ”„ äº”ã€æ•°æ®æµè®¾è®¡

### ç”¨æˆ·æé—® â†’ Agentå“åº”æµç¨‹

```
ç”¨æˆ·æé—®
    â†“
Agentç†è§£Query
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tool Selection  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. GraphQuery   â”‚ â†’ æœç´¢ç”¨æˆ·å›¾è°± â†’ ä¸è¶³ â†’ æœç´¢å…¨å±€å›¾è°±
â”‚ 2. ExtSearch    â”‚ â†’ è§¦å‘å¤–éƒ¨æœç´¢ â†’ è‡ªåŠ¨æ„å»ºå›¾è°±
â”‚ 3. PaperCompareâ”‚ â†’ è®ºæ–‡å¯¹æ¯”
â”‚ 4. Community   â”‚ â†’ ç¤¾åŒºæŸ¥è¯¢
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ä¸Šä¸‹æ–‡èšåˆ
    â†“
LLMç”Ÿæˆå›ç­”
    â†“
å¼•ç”¨æ¥æºæ ‡æ³¨
    â†“
è¿”å›ç”¨æˆ· + æ›´æ–°ç”¨æˆ·ç”»åƒ
```

### è®ºæ–‡ä¸Šä¼  â†’ å›¾è°±æ„å»ºæµç¨‹

```
ç”¨æˆ·ä¸Šä¼ PDF
    â†“
PDFè§£æï¼ˆPyMuPDF/pdfplumberï¼‰
    â†“
Sectionåˆ†å‰²
    â†“
æ‰¹é‡æ„å»ºEpisodes
    â†“
LLMæŠ½å–å®ä½“å’Œå…³ç³»
    â†“
å†™å…¥å›¾è°±ï¼ˆç”¨æˆ·namespace + å…¨å±€namespaceï¼‰
    â†“
è§¦å‘Community Detection
    â†“
ç”Ÿæˆè®ºæ–‡æ‘˜è¦å’Œç»“æ„åŒ–ä¿¡æ¯
    â†“
è¿”å›ç”¨æˆ·
```

---

## ğŸ’¡ å…­ã€æ¶æ„ä¼˜åŠ¿

### æ”¹è¿›åçš„æ¶æ„ä¼˜åŠ¿ï¼š

1. **æ¨¡å—åŒ–æ¸…æ™°** - æ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹æœåŠ¡ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
2. **åŒå›¾è°±è®¾è®¡** - å…¼é¡¾ä¸ªæ€§åŒ–å’Œå…±äº«çŸ¥è¯†
3. **å·¥å…·åŒ–Agent** - çµæ´»çš„å·¥å…·è°ƒç”¨æœºåˆ¶
4. **è‡ªåŠ¨æ‰©å±•** - å¤–éƒ¨æœç´¢fallbackæœºåˆ¶ä½¿å›¾è°±è‡ªåŠ¨å¢é•¿
5. **ç”¨æˆ·ç”»åƒ** - è‡ªåŠ¨æ„å»ºç”¨æˆ·ç ”ç©¶ç”»åƒ
6. **Schemaè§„èŒƒ** - ç»Ÿä¸€çš„å®ä½“å’Œå…³ç³»ç±»å‹
7. **å¼‚æ­¥ä»»åŠ¡** - é•¿æ—¶é—´ä»»åŠ¡åå°å¤„ç†
8. **å¯æ‰©å±•æ€§** - æ˜“äºæ·»åŠ æ–°çš„æ•°æ®æºå’ŒåŠŸèƒ½

---

## ğŸš¨ ä¸ƒã€éœ€è¦æ³¨æ„çš„æŠ€æœ¯éš¾ç‚¹

1. **å®ä½“å»é‡å’Œå½’ä¸€åŒ–** - éœ€è¦embeddingç›¸ä¼¼åº¦åŒ¹é…
2. **Communityæ£€æµ‹æ€§èƒ½** - å¤§è§„æ¨¡å›¾è°±çš„ç¤¾åŒºæ£€æµ‹è€—æ—¶
3. **å¹¶å‘æ§åˆ¶** - å¤šç”¨æˆ·åŒæ—¶æŸ¥è¯¢å’Œå†™å…¥
4. **LLMæˆæœ¬æ§åˆ¶** - å¤§é‡å®ä½“æŠ½å–çš„APIæˆæœ¬
5. **æœç´¢è´¨é‡** - Hybrid searchçš„å‚æ•°è°ƒä¼˜
6. **æ—¶é—´çº¿ç®¡ç†** - äº‹å®çš„valid/invalidæ—¶é—´çº¿
7. **ç¼“å­˜ç­–ç•¥** - å‡å°‘é‡å¤çš„å›¾è°±æŸ¥è¯¢

---

## ğŸ“‹ å…«ã€ä¸‹ä¸€æ­¥ï¼šè¯¦ç»†å¼€å‘TodoList

è§ä¸‹ä¸€ä»½æ–‡æ¡£ã€Šé¡¹ç›®åç«¯å¼€å‘TodoList.mdã€‹

