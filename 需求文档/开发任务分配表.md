# 📋 开发任务分配表
# AI科研助手系统 v1.0

**文档版本**: v1.4 (新增交互式图谱可视化功能)  
**项目启动日期**: 2025-12-10  
**预计完成日期**: 2026-02-09（8周）  
**最后更新**: 2025-12-10

---

## 🎯 快速导航

| 开发人员 | 负责模块 | 任务卡片 | 预计工期 |
|---------|---------|---------|---------|
| 后端开发H | [用户认证模块](#后端开发h-用户认证模块) | 7个需求 | 1周 |
| 后端开发A | [论文管理模块](#后端开发a-论文管理模块) | 2个需求 | 1.5周 |
| 后端开发B | [知识图谱模块](#后端开发b-知识图谱模块) | 4个需求 | 3周 |
| 后端开发C | [智能问答模块](#后端开发c-智能问答模块) | 3个需求 | 3周 |
| 后端开发D | ~~用户画像模块~~ | **已删除** | - |
| 后端开发E | [搜索推荐模块](#后端开发e-搜索推荐模块) | 1个需求 | 1周 |
| 后端开发F | [社区管理模块](#后端开发f-社区管理模块) | 2个需求 | 1.5周 |
| 后端开发G | [**图谱可视化模块**](#后端开发g-图谱可视化模块) | **5个需求** | **1.5周** |

---

## 👤 后端开发H: 用户认证模块

**负责人**: @开发H  
**优先级**: P0（基础功能）  
**开始时间**: Week 1  
**依赖**: 无（最先开发）

### 📌 任务清单

#### ✅ 任务1: 用户注册（REQ-H1）
**工期**: 1天 | **优先级**: P0

**功能**:
- 用户注册接口
- 邮箱唯一性验证
- 密码bcrypt加密（cost=12）
- 生成JWT Token

**API端点**:
```
POST /api/auth/register
```

**请求参数**:
```json
{
  "username": "zhangsan",
  "email": "zhangsan@example.com",
  "password": "SecurePassword123!"
}
```

**说明**: 邮箱格式验证、密码强度验证由前端负责。

**核心代码位置**:
- `app/api/routes/auth.py` - 认证路由
- `app/services/auth_service.py` - 认证服务
- `app/models/user_models.py` - 用户模型
- `app/core/security.py` - 密码加密、Token生成

**验收标准**:
- [ ] 邮箱唯一性验证
- [ ] bcrypt加密正确（cost=12）
- [ ] 响应时间 < 1秒
- [ ] 错误提示清晰

---

#### ✅ 任务2: 用户登录（REQ-H2）
**工期**: 1天 | **优先级**: P0

**功能**:
- 用户登录接口
- 验证用户凭证
- 生成JWT Token（access + refresh）
- 更新登录时间
- 登录失败3次锁定账户（5分钟）

**API端点**:
```
POST /api/auth/login
```

**JWT Token配置**:
- access_token: 有效期1小时
- refresh_token: 有效期7天
- 算法: HS256

**JWT Token内容**:
```json
{
  "sub": "u_1234567890",  // user_id
  "email": "zhangsan@example.com",
  "exp": 1704456789,
  "iat": 1704453189
}
```

**说明**: 不再包含user_role字段。

**验收标准**:
- [ ] 正确验证凭证
- [ ] 生成有效Token
- [ ] 更新登录时间
- [ ] 失败锁定机制
- [ ] 响应时间 < 500ms

---

#### ✅ 任务3: Token刷新（REQ-H3）
**工期**: 0.5天 | **优先级**: P0

**功能**:
- 使用refresh_token获取新access_token
- 验证refresh_token有效性

**API端点**:
```
POST /api/auth/refresh
```

**验收标准**:
- [ ] 验证refresh_token
- [ ] 生成新access_token
- [ ] 响应时间 < 200ms

---

#### ✅ 任务4: 用户登出（REQ-H4）
**工期**: 0.5天 | **优先级**: P0

**功能**:
- 用户登出
- Token加入Redis黑名单
- 设置正确的TTL

**API端点**:
```
POST /api/auth/logout
```

**技术实现**:
```python
redis_client.setex(
    f"blacklist:{token}",
    ttl=token_remaining_time,
    value="1"
)
```

**验收标准**:
- [ ] Token加入黑名单
- [ ] 黑名单Token无法访问API
- [ ] TTL设置正确

---

#### ✅ 任务5: 获取用户信息（REQ-H5）
**工期**: 0.5天 | **优先级**: P0

**功能**:
- 获取当前登录用户信息
- 解析JWT Token

**API端点**:
```
GET /api/auth/me
```

**验收标准**:
- [ ] 正确解析Token
- [ ] 返回完整用户信息
- [ ] 响应时间 < 200ms

---

#### ✅ 任务6: 密码修改（REQ-H6）
**工期**: 0.5天 | **优先级**: P1

**功能**:
- 修改密码
- 验证旧密码
- 密码加密存储

**API端点**:
```
POST /api/auth/change-password
```

**请求参数**:
```json
{
  "old_password": "OldPassword123!",
  "new_password": "NewPassword456!"
}
```

**说明**: 新密码强度验证、两次新密码一致性验证由前端负责。

**验收标准**:
- [ ] 验证旧密码
- [ ] 密码加密存储

---

#### ✅ 任务7: JWT认证中间件（REQ-H7）
**工期**: 1天 | **优先级**: P0

**功能**:
- 实现JWT认证依赖
- 验证Token有效性
- 检查黑名单
- 获取当前用户信息

**核心代码位置**:
- `app/api/dependencies/auth.py`

**实现要点**:
```python
async def get_current_user(
    credentials: HTTPAuthorizationCredentials = Depends(security)
) -> dict:
    # 1. 检查黑名单
    # 2. 验证Token
    # 3. 获取用户信息
    return user
```

**验收标准**:
- [ ] 正确验证Token
- [ ] 处理过期Token
- [ ] 处理黑名单Token
- [ ] 处理无效Token
- [ ] 性能影响 < 50ms

---

### 📦 交付物

- [ ] 7个API端点实现
- [ ] JWT认证中间件
- [ ] 密码加密工具
- [ ] Token生成工具
- [ ] Redis黑名单管理
- [ ] 单元测试（覆盖率 > 80%）
- [ ] API文档

### 📞 协作接口

**提供给其他模块**:
- `get_current_user` - JWT认证依赖（所有模块使用）
- `AuthService` - 认证服务
- `SecurityUtils` - 密码加密、Token生成

**依赖**:
- MySQL数据库
- Redis（Token黑名单）
- python-jose（JWT）
- passlib[bcrypt]（密码加密）

### 🗄️ 数据库迁移

**Alembic迁移脚本**:
```bash
# 创建用户表迁移
alembic revision -m "create users table"

# 执行迁移
alembic upgrade head
```

**迁移脚本位置**:
- `alembic/versions/001_create_users.py`

**users表结构**:
```sql
CREATE TABLE users (
    user_id VARCHAR(50) PRIMARY KEY,
    username VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP NULL,
    is_active BOOLEAN DEFAULT TRUE,
    failed_login_attempts INT DEFAULT 0,
    locked_until TIMESTAMP NULL
);
```

**说明**: 不再包含user_role字段。

---

## 👤 后端开发A: 论文管理模块

**负责人**: @开发A  
**优先级**: P0（核心功能）  
**开始时间**: Week 3-4  
**依赖**: Module H（用户认证）+ Module B（图谱）完成

### 📌 任务清单

#### ✅ 任务1: 论文上传和解析（REQ-A1）
**工期**: 1周 | **优先级**: P0

**功能**:
- 接收PDF文件上传（< 50MB）
- 使用PyMuPDF解析PDF
- 提取章节、元数据、参考文献
- 按section分块文本
- 调用Graphiti.add_episode实现实体抽取和图谱构建

**API端点**:
```
POST /api/papers/upload
```

**核心代码位置**:
- `app/api/routes/papers.py` - API路由
- `app/services/ingest_service.py` - 摄入逻辑
- `app/services/pdf_parser.py` - PDF解析
- `app/tasks/ingest_tasks.py` - 异步任务

**处理流程**:
```
PDF解析 → 文本分块 → 调用graphiti.add_episode() 
  → 自动LLM实体抽取 → 自动关系抽取 → 写入图谱
```

**依赖**:
- 图谱服务（Module B）
- Graphiti SDK（内部调用LLM进行实体抽取）

**验收标准**:
- [ ] 支持PDF上传
- [ ] 解析准确率 > 80%
- [ ] 实体抽取覆盖率 > 85%
- [ ] 处理时间 < 2分钟
- [ ] 异步任务可监控
- [ ] 错误处理完善

**测试用例**: 3个（正常上传、文件过大、格式错误）

---

#### ✅ 任务2: 论文详情（REQ-A2）
**工期**: 2天 | **优先级**: P0

**功能**:
- 获取论文完整信息
- 包含实体和关系
- 推荐相关论文

**API端点**:
```
GET /api/papers/{paper_id}
```

**核心代码位置**:
- `app/api/routes/papers.py`
- `app/services/graph_service.py`

**验收标准**:
- [ ] 返回完整信息
- [ ] 包含实体关系
- [ ] 响应时间 < 500ms

---

### 📦 交付物

- [ ] 2个API端点实现
- [ ] PDF解析器完整
- [ ] 异步任务配置
- [ ] 单元测试（覆盖率 > 70%）
- [ ] API文档

**说明**: 论文查询功能已删除（与Module B的图谱搜索功能重复）。

### 📞 协作接口

**向Module B提供**:
- 解析后的文本数据

**从Module B获取**:
- Graphiti客户端（调用add_episode）
- 图谱查询接口

---

## 👤 后端开发B: 知识图谱模块

**负责人**: @开发B  
**优先级**: P0（核心基础）  
**开始时间**: Week 1-2  
**依赖**: 无（与Module H并行开发）

### 📌 任务清单

#### ✅ 任务1: Schema定义（REQ-B4）
**工期**: 2天 | **优先级**: P0

**功能**:
- 定义8种实体类型
- 定义9种关系类型
- Pydantic验证

**核心代码位置**:
- `app/schemas/entities.py`
- `app/schemas/relations.py`
- `app/schemas/validators.py`

**实体类型**:
```python
Paper, Method, Dataset, Task, Metric, 
Author, Institution, Concept
```

**关系类型**:
```python
PROPOSES, EVALUATES_ON, SOLVES, IMPROVES_OVER,
CITES, USES_METRIC, AUTHORED_BY, 
AFFILIATED_WITH, HAS_CONCEPT
```

**验收标准**:
- [ ] 8种实体完整定义
- [ ] 9种关系完整定义
- [ ] Pydantic验证通过
- [ ] 单元测试覆盖率 > 90%

---

#### ✅ 任务2: 图谱搜索（REQ-B1）
**工期**: 1周 | **优先级**: P0

**功能**:
- 混合搜索（语义 + BM25）
- 双图谱Fallback机制
- 3种重排模式（RRF/MMR/Cross-Encoder）
- Node Distance重排

**API端点**:
```
POST /api/graph/search
```

**核心代码位置**:
- `app/api/routes/graph.py`
- `app/services/graph_service.py`
- `app/services/namespace_service.py`
- `app/core/graphiti_client.py`

**关键逻辑**:
```python
# 双图谱Fallback
用户图谱 → 全局图谱 → 外部搜索
```

**验收标准**:
- [ ] 混合搜索正确
- [ ] Fallback机制正确
- [ ] 支持3种重排
- [ ] 响应时间 < 2秒
- [ ] 搜索相关性 > 70%

---

#### ✅ 任务3: 节点查询（REQ-B2）
**工期**: 2天 | **优先级**: P0

**功能**:
- 通过UUID获取节点
- 获取邻居节点
- 获取社区信息

**API端点**:
```
GET /api/graph/node/{uuid}
GET /api/graph/node/{uuid}/neighbors
```

**验收标准**:
- [ ] 正确返回节点信息
- [ ] 包含1-hop邻居
- [ ] 响应时间 < 500ms

---

#### ✅ 任务4: 路径查询（REQ-B3）
**工期**: 2天 | **优先级**: P1

**功能**:
- 查找两节点间路径
- 最短路径优先
- 支持多条路径

**API端点**:
```
POST /api/graph/path
```

**验收标准**:
- [ ] 找到最短路径
- [ ] 支持多条路径
- [ ] 超时保护（5秒）

---

### 📦 交付物

- [ ] Schema完整定义
- [ ] Graphiti客户端增强
- [ ] Namespace服务
- [ ] 4个API端点
- [ ] 单元测试（覆盖率 > 80%）

### 📞 协作接口

**提供给其他模块**:
- `GraphService` - 图谱操作服务
- `NamespaceService` - 命名空间管理
- `GraphitiClient` - Graphiti封装

**依赖**:
- Graphiti SDK
- Neo4j数据库

---

## 👤 后端开发C: 智能问答模块

**负责人**: @开发C  
**优先级**: P0（核心功能）  
**开始时间**: Week 5-7  
**依赖**: Module A, B完成

### 📌 任务清单

#### ✅ 任务1: Agent工具系统（REQ-C2）
**工期**: 1.5周 | **优先级**: P0

**功能**:
- 实现6个核心工具
- 工具注册机制
- 工具调用框架

**6个工具**:
1. `GraphQueryTool` - 图谱查询
2. `ExternalSearchTool` - 外部搜索
3. `PDFParseTool` - PDF解析
4. `PaperCompareTool` - 论文对比（v2.0功能，当前返回基础对比）
5. `CommunityQueryTool` - 社区查询
6. `UserProfileTool` - 用户画像查询（v2.0功能，当前返回基础信息）

**核心代码位置**:
- `app/tools/base.py` - Tool基类
- `app/tools/graph_query_tool.py`
- `app/tools/external_search_tool.py`
- `app/tools/pdf_parse_tool.py`
- `app/tools/paper_compare_tool.py`
- `app/tools/community_query_tool.py` (依赖Module F)
- `app/tools/tool_registry.py`

**验收标准**:
- [ ] 6个工具全部实现
- [ ] 工具注册机制正常
- [ ] 每个工具有单元测试
- [ ] 工具文档完整

---

#### ✅ 任务2: Agent对话（REQ-C1）
**工期**: 1.5周 | **优先级**: P0

**功能**:
- 理解用户意图
- 选择和调用工具
- 聚合上下文
- 生成回答
- 标注引用

**API端点**:
```
POST /api/chat
```

**核心代码位置**:
- `app/api/routes/chat.py`
- `app/services/agent_service.py`
- `app/services/context_service.py`
- `app/integrations/llm_client.py`
- `app/prompts/system_prompt.py`

**工作流程**:
```
理解意图 → 选择工具 → 执行工具 → 
聚合上下文 → 生成回答 → 标注引用
```

**验收标准**:
- [ ] Agent理解意图正确
- [ ] 正确调用工具
- [ ] 回答包含引用
- [ ] 回答质量 > 4/5
- [ ] 响应时间 < 10秒
- [ ] 错误处理完善

**测试用例**: 3个（基础问答、外部搜索、长对话）

---

#### ✅ 任务3: 对话历史（REQ-C3）
**工期**: 1天 | **优先级**: P1

**功能**:
- 保存聊天记录
- 查询历史记录
- 支持分页和筛选

**API端点**:
```
GET /api/history/chat/{user_id}
```

**核心代码位置**:
- `app/api/routes/history.py`
- `app/services/history_service.py`
- `app/models/history_models.py`

**验收标准**:
- [ ] 正确保存记录
- [ ] 支持分页查询
- [ ] 响应时间 < 500ms

---

### 📦 交付物

- [ ] 6个工具实现
- [ ] Agent对话系统
- [ ] LLM客户端封装
- [ ] 对话历史管理
- [ ] 3个API端点
- [ ] 单元测试（覆盖率 > 70%）
- [ ] Prompt模板

### 📞 协作接口

**向其他模块提供**:
- `AgentService` - Agent服务
- `LLMClient` - LLM客户端
- `ToolRegistry` - 工具注册器

**依赖**:
- Module A (论文管理)
- Module B (图谱服务)
- Module E (外部搜索)
- Module F (社区管理)
- OpenAI API

**说明**: PaperCompareTool和UserProfileTool由于对应功能删除，当前只提供基础实现。

---

## 👤 后端开发D: 用户画像模块（已删除）

**负责人**: ~~@开发D~~  
**优先级**: ~~P1~~ → **已删除，延后到v2.0**  
**开始时间**: ~~Week 6-7~~ → **不开发**  

### 📌 删除说明

**删除理由**:
1. **MVP原则**: 用户画像需要大量用户行为数据积累才有意义，初期效果有限
2. **开发成本高**: 需要TF-IDF计算、LLM分析、社区构建等复杂逻辑（2周开发时间）
3. **依赖性强**: 依赖聊天历史、阅读历史等数据，MVP阶段数据量不足
4. **可延后**: 不影响核心功能（论文解析、智能问答），可在v2.0再添加

**原计划功能**（已删除）:
- ~~用户画像构建（REQ-D1）~~
- ~~阅读历史追踪（REQ-D2）~~

**影响**:
- Module E的论文推荐功能也一并删除（依赖用户画像）
- Module C的UserProfileTool暂时返回空数据或基础信息

---

**注意**: 如果后续需要恢复此模块，请参考PRD v1.2版本。

---

## 👤 后端开发E: 搜索推荐模块

**负责人**: @开发E  
**优先级**: P1（重要功能）  
**开始时间**: Week 7  
**依赖**: Module A, B完成

### 📌 任务清单

#### ✅ 任务1: 外部搜索集成（REQ-E1）
**工期**: 1周 | **优先级**: P1

**功能**:
- arXiv API集成
- Semantic Scholar API集成
- 自动下载PDF
- 自动摄入图谱

**API端点**:
```
POST /api/search/external
```

**核心代码位置**:
- `app/integrations/arxiv_client.py`
- `app/integrations/semantic_scholar_client.py`
- `app/services/external_search_service.py`

**自动摄入流程**:
```
搜索arXiv → 下载PDF → 解析 → 抽取实体 → 写入图谱
```

**验收标准**:
- [ ] arXiv集成正常
- [ ] S2集成正常
- [ ] 自动摄入正确
- [ ] 响应时间 < 5秒
- [ ] 错误处理（限流、网络）

---

### 📦 交付物

- [ ] 外部搜索集成（arXiv + Semantic Scholar）
- [ ] 1个API端点
- [ ] 单元测试（覆盖率 > 70%）

**说明**: 论文推荐（REQ-E2）和论文对比（REQ-E3）已删除，延后到v2.0。

### 📞 协作接口

**向其他模块提供**:
- `ExternalSearchService` - 外部搜索服务
- `ArxivClient` - arXiv API客户端
- `SemanticScholarClient` - Semantic Scholar API客户端

**依赖**:
- Module A (摄入服务)
- Module B (图谱服务)

---

## 👤 后端开发F: 社区管理模块

**负责人**: @开发F  
**优先级**: P2（增强功能）  
**开始时间**: Week 8  
**依赖**: Module B完成

### 📌 任务清单

#### ✅ 任务1: 社区检测（REQ-F1）
**工期**: 3天 | **优先级**: P2

**功能**:
- 调用Graphiti社区检测
- 支持用户和全局图谱
- 异步任务执行
- 进度监控

**API端点**:
```
POST /api/communities/detect
```

**核心代码位置**:
- `app/services/community_service.py`
- `app/tasks/community_tasks.py`

**技术实现**:
```python
await graphiti.build_communities(
    group_id=group_id,
    update_communities=True
)
```

**验收标准**:
- [ ] 正确调用Graphiti API
- [ ] 支持双图谱
- [ ] 异步执行
- [ ] 进度可监控

---

#### ✅ 任务2: 社区查询（REQ-F2）
**工期**: 2天 | **优先级**: P2

**功能**:
- 查询社区列表
- 获取社区详情
- 获取社区节点
- 用户社区查询

**API端点**:
```
GET /api/communities
GET /api/communities/{community_id}
GET /api/communities/user/{user_id}
```

**验收标准**:
- [ ] 正确获取列表
- [ ] 包含社区摘要
- [ ] 响应时间 < 1秒

---

### 📦 交付物

- [ ] 社区检测服务
- [ ] 3个API端点
- [ ] 异步任务
- [ ] 单元测试（覆盖率 > 70%）

### 📞 协作接口

**向其他模块提供**:
- `CommunityService` - 社区管理服务

**依赖**:
- Module B (Graphiti客户端)

---

## 👤 后端开发G: 图谱可视化模块

**负责人**: @开发G  
**优先级**: **P1（重要功能）**  
**开始时间**: Week 7-8（可与Module F并行）  
**依赖**: Module B完成

**使用场景**:  
用户在前端图谱可视化页面可以：
- 查看自己的个人知识图谱（节点和边的可视化）
- 交互式探索：点击节点查看详细属性
- 交互式探索：点击边查看关系属性
- 筛选和过滤：按实体类型、关系类型筛选
- 局部探索：展开某个节点的邻居节点

### 📌 任务清单

#### ✅ 任务1: 用户图谱数据获取（REQ-G1）
**工期**: 3天 | **优先级**: P1

**功能**:
- 获取用户个人图谱的节点和边数据
- 支持按节点类型、关系类型筛选
- 支持分页（最大500节点）
- 支持局部查询（center_node + max_hops）
- JWT认证和权限控制

**API端点**:
```
GET /api/graph/visualization/my-graph
```

**请求参数**:
- `node_types`: 筛选节点类型（可选）
- `relation_types`: 筛选关系类型（可选）
- `limit`: 最大返回节点数，默认500（可选）
- `center_node_uuid`: 中心节点UUID（可选）
- `max_hops`: 从中心节点的最大跳数，默认2（可选）
- `include_properties`: 是否包含详细属性，默认false（可选）

**核心代码位置**:
- `app/api/routes/visualization.py`
- `app/services/visualization_service.py`

**验收标准**:
- [ ] 支持JWT认证
- [ ] 用户只能查看自己的图谱
- [ ] 支持按节点类型筛选
- [ ] 支持按关系类型筛选
- [ ] 支持局部图谱查询
- [ ] 大图谱（>5000节点）响应时间 < 5秒
- [ ] 返回格式适配前端可视化库

---

#### ✅ 任务2: 节点详情查询（REQ-G2）
**工期**: 1天 | **优先级**: P1

**功能**:
- 用户点击节点时获取完整属性
- 返回节点的所有属性信息
- 包含邻居节点列表（incoming/outgoing）
- 权限验证（用户只能查看自己图谱中的节点）

**API端点**:
```
GET /api/graph/nodes/{node_uuid}
```

**响应内容**:
- 节点基础信息（uuid, type, name, properties）
- 邻居节点列表（incoming/outgoing）
- 统计信息（总邻居数、入边数、出边数）

**核心代码位置**:
- `app/api/routes/graph.py`
- `app/services/graph_service.py`

**验收标准**:
- [ ] 正确返回节点所有属性
- [ ] 包含邻居节点列表
- [ ] 权限验证正确（403/404）
- [ ] 响应时间 < 500ms

---

#### ✅ 任务3: 边详情查询（REQ-G3）
**工期**: 1天 | **优先级**: P1

**功能**:
- 用户点击边时获取关系属性
- 返回边的完整属性信息
- 包含源节点和目标节点信息
- 权限验证

**API端点**:
```
GET /api/graph/edges/{edge_uuid}
```

或者使用：
```
GET /api/graph/edges?source={source_uuid}&target={target_uuid}&type={relation_type}
```

**响应内容**:
- 边基础信息（uuid, type, properties）
- 源节点和目标节点信息
- 上下文信息（相关论文、共现次数）

**核心代码位置**:
- `app/api/routes/graph.py`
- `app/services/graph_service.py`

**验收标准**:
- [ ] 正确返回边的所有属性
- [ ] 包含源节点和目标节点信息
- [ ] 权限验证正确（403/404）
- [ ] 响应时间 < 300ms

---

#### ✅ 任务4: 图谱统计概览（REQ-G4）
**工期**: 1天 | **优先级**: P2

**功能**:
- 获取用户图谱的统计信息
- 在可视化页面顶部显示
- 支持缓存（更新频率5分钟）

**API端点**:
```
GET /api/graph/visualization/stats
```

**响应内容**:
- 总节点数、总边数
- 按类型分类统计（节点类型、关系类型）
- 图谱更新时间
- Top节点（按degree排序）

**核心代码位置**:
- `app/api/routes/visualization.py`
- `app/services/visualization_service.py`

**验收标准**:
- [ ] 正确统计节点和边数量
- [ ] 按类型分类统计
- [ ] 包含图谱更新时间
- [ ] 响应时间 < 1秒
- [ ] 支持缓存（Redis，TTL=5分钟）

---

#### ✅ 任务5: 节点邻居展开（REQ-G5）
**工期**: 1.5天 | **优先级**: P1

**功能**:
- 用户双击节点，展开未显示的邻居
- 支持方向筛选（incoming/outgoing/both）
- 支持类型筛选
- 支持分页

**API端点**:
```
GET /api/graph/nodes/{node_uuid}/neighbors
```

**请求参数**:
- `direction`: incoming / outgoing / both，默认both（可选）
- `node_types`: 筛选邻居节点类型（可选）
- `relation_types`: 筛选关系类型（可选）
- `limit`: 最大返回邻居数，默认50（可选）

**响应内容**:
- 新增节点列表
- 新增边列表
- 元数据（总邻居数、返回数量、是否还有更多）

**核心代码位置**:
- `app/api/routes/graph.py`
- `app/services/graph_service.py`

**前端使用场景**:
```javascript
// 用户双击节点时
async function onNodeDoubleClick(nodeId) {
  const response = await fetch(`/api/graph/nodes/${nodeId}/neighbors?limit=20`, {
    headers: { 'Authorization': `Bearer ${token}` }
  });
  const data = await response.json();
  
  // 将新节点和边添加到现有图谱
  graph.addNodes(data.neighbors.nodes);
  graph.addEdges(data.neighbors.edges);
}
```

**验收标准**:
- [ ] 正确返回邻居节点和边
- [ ] 支持方向筛选
- [ ] 支持类型筛选
- [ ] 支持分页
- [ ] 响应时间 < 1秒

---

### 📦 交付物

- [ ] 5个API端点实现
- [ ] 可视化服务
- [ ] 图谱统计服务（含缓存）
- [ ] 权限控制完整
- [ ] 单元测试（覆盖率 > 70%）
- [ ] API文档完整
- [ ] 前端集成示例代码

### 📞 协作接口

**向其他模块提供**:
- `VisualizationService` - 可视化服务
- 5个REST API端点（供前端使用）

**向前端提供**:
- 完整的交互式图谱可视化API
- 节点/边详情查询API
- 支持前端构建类似Neo4j Browser的可视化界面

**依赖**:
- Module B (图谱服务、GraphitiClient)
- Module H (JWT认证中间件)
- Redis (统计数据缓存)

---

## 📅 时间线总览（v1.4更新）

```
Week 1:      Module H (用户认证) 🔴
Week 1-2:    Module B (图谱基础) 🟦🟦 (与H部分并行)
Week 3-4:    Module A (论文管理) 🟩🟩 (简化为1.5周)
Week 5-7:    Module C (智能问答) 🟨🟨🟨
Week 7:      Module E (外部搜索) 🟧 (简化为1周)
Week 7-8:    Module F (社区管理) 🟫 (1.5周)
Week 7-8.5:  Module G (图谱可视化) ⬜🔵 (1.5周，P1优先级提升)
```

**变更说明**:
- ❌ Module D（用户画像）已删除
- ⏱️ Module A 从2周减少到1.5周（删除论文查询）
- ⏱️ Module E 从2周减少到1周（删除推荐和对比）
- ⬆️ **Module G 优先级从P2提升到P1**（交互式图谱可视化）
- ⏱️ **Module G 工期从1周增加到1.5周**（5个API端点）
- 📅 整体工期约8周（Module F和G可并行开发）

---

## ✅ 每周检查清单

### 开发人员每周自查

- [ ] 本周任务是否按时完成？
- [ ] 代码是否通过Lint检查？
- [ ] 单元测试是否编写并通过？
- [ ] API文档是否更新？
- [ ] 是否有阻塞问题需要上报？

### 项目经理每周检查

- [ ] 所有模块进度是否正常？
- [ ] 是否有跨模块协调问题？
- [ ] 风险清单是否更新？
- [ ] 下周计划是否明确？

---

## 📞 沟通机制

### 每日站会（10:00 AM，15分钟）
**参与**: 全体开发人员  
**内容**:
- 昨天完成了什么？
- 今天计划做什么？
- 有什么阻塞问题？

### 周会（周五下午，1小时）
**参与**: 全体团队  
**内容**:
- Demo本周成果
- Review进度
- 规划下周任务
- 讨论技术问题

### 技术评审（按需）
**参与**: 相关开发人员 + 技术负责人  
**内容**:
- 评审设计方案
- 讨论技术选型
- 解决技术难题

---

## 📋 代码提交规范

### Commit Message格式
```
<type>(<scope>): <subject>

类型(type):
- feat: 新功能
- fix: Bug修复
- docs: 文档更新
- style: 代码格式
- refactor: 重构
- test: 测试
- chore: 构建/工具

示例:
feat(papers): implement PDF upload API
fix(graph): correct search fallback logic
docs(api): update chat API documentation
```

### PR流程
1. 创建功能分支: `feature/module-a-upload`
2. 开发并自测
3. 提交PR，填写Description
4. 至少1人Review
5. CI通过后合并

---

## 🐛 Bug提交模板

```markdown
**Bug描述**:
[简要描述Bug]

**复现步骤**:
1. ...
2. ...

**预期行为**:
[应该发生什么]

**实际行为**:
[实际发生了什么]

**环境**:
- OS: Windows/Linux/Mac
- Python版本: 3.10
- 模块: Module A

**优先级**: P0/P1/P2

**负责人**: @开发X
```

---

## 📚 参考文档

- **完整PRD**: `PRD_产品需求文档.md`
- **架构概览**: `项目架构概览.md`
- **开发TodoList**: `开发日志/项目后端开发TodoList.md`
- **快速开始**: `快速开始指南.md`
- **Graphiti文档**: `Graphiti API文档.md`

---

## 📧 联系方式

| 问题类型 | 联系人 | 方式 |
|---------|--------|------|
| 进度问题 | 项目经理 | pm@example.com |
| 技术问题 | 技术负责人 | tl@example.com |
| 环境问题 | DevOps | ops@example.com |

---

**祝各位开发顺利！** 🚀

---

## 📋 v1.3 更新说明

**更新日期**: 2025-12-09  
**更新内容**: 同步PRD v1.3修改

### 主要变更

1. **Module H（用户认证）**:
   - 移除`user_role`字段
   - 移除`confirm_password`参数
   - 前后端职责明确（验证逻辑前置到前端）

2. **Module A（论文管理）**:
   - 删除任务2（论文查询）- 与图谱搜索重复
   - 任务3改为任务2
   - 明确通过Graphiti.add_episode实现实体抽取
   - 工期: 2周 → 1.5周

3. **Module D（用户画像）**:
   - ❌ 整个模块删除，延后到v2.0
   - 理由: MVP阶段数据不足，开发成本高

4. **Module E（搜索推荐）**:
   - 删除任务2（论文推荐）
   - 删除任务3（论文对比）
   - 仅保留外部搜索集成
   - 工期: 2周 → 1周

5. **Module C（智能问答）**:
   - PaperCompareTool和UserProfileTool提供基础实现
   - 完整功能延后到v2.0

### 影响分析

**开发工期优化**:
- 原计划: 8周（多模块并行）
- 新计划: 7-8周（更聚焦）

**资源调配**:
- 开发D的资源可以支援其他模块
- 减少跨模块依赖，降低协调成本

**风险降低**:
- MVP范围更清晰
- 核心功能更聚焦
- 质量更有保障

*更新时间: 2025-12-09*

---

## 📋 v1.4 更新说明

**更新日期**: 2025-12-10  
**更新内容**: 同步PRD v1.4修改 - Module G 图谱可视化模块重大升级

### 主要变更

**Module G（图谱可视化模块）** - 🎉 **重大升级**

**从**: 简单的数据导出（1个API，P2优先级）  
**到**: 完整的交互式图谱可视化系统（5个API，P1优先级）

#### 新增功能

1. **REQ-G1: 用户图谱数据获取** ⭐
   - 获取用户个人图谱数据供前端渲染
   - 支持筛选（节点类型、关系类型）
   - 支持分页（最大500节点，防止卡顿）
   - 支持局部查询（center_node + max_hops）
   - JWT认证和权限控制

2. **REQ-G2: 节点详情查询** 🔍
   - 用户点击节点查看完整属性
   - 返回节点属性 + 邻居列表 + 统计信息
   - 响应时间 < 500ms

3. **REQ-G3: 边详情查询** 🔗
   - 用户点击边查看关系属性
   - 返回边属性 + 源/目标节点信息
   - 响应时间 < 300ms

4. **REQ-G4: 图谱统计概览** 📈
   - 显示图谱统计信息（节点数、边数、类型分布）
   - 支持Redis缓存（TTL=5分钟）
   - 响应时间 < 1秒

5. **REQ-G5: 节点邻居展开** 🌳
   - 双击节点展开未显示的邻居
   - 支持方向筛选（incoming/outgoing/both）
   - 支持类型筛选和分页

#### 技术变更

**API端点变化**:
- **删除**: `GET /api/visualization/graph/{group_id}` (旧的导出API)
- **删除**: `GET /api/visualization/community/{community_id}`
- **删除**: `GET /api/visualization/paper/{paper_id}`
- **新增**: `GET /api/graph/visualization/my-graph` (用户图谱数据)
- **新增**: `GET /api/graph/nodes/{node_uuid}` (节点详情)
- **新增**: `GET /api/graph/edges/{edge_uuid}` (边详情)
- **新增**: `GET /api/graph/visualization/stats` (统计概览)
- **新增**: `GET /api/graph/nodes/{node_uuid}/neighbors` (邻居展开)

**优先级和工期调整**:
- **优先级**: P2（增强功能）→ **P1（重要功能）**
- **工期**: 1周 → **1.5周**
- **任务数**: 1个 → **5个**

**新增依赖**:
- Module H (JWT认证中间件)
- Redis (统计缓存)

#### 前端支持场景

现在后端API完整支持前端构建类似 **Neo4j Browser** 或 **Gephi** 的交互式图谱可视化界面：

✅ 查看完整图谱  
✅ 点击节点查看属性  
✅ 点击边查看关系  
✅ 筛选和过滤  
✅ 双击展开邻居  
✅ 查看统计概览  

#### 影响分析

**开发工期**:
- Module G工期增加0.5周
- 但由于可与Module F并行，整体工期不变（8周内）

**资源需求**:
- 开发G需要更多时间
- 需要与前端团队密切协作

**功能价值**:
- ⬆️ 用户体验显著提升
- ⬆️ 系统可用性增强
- ⬆️ 产品竞争力提升

**风险控制**:
- ✅ 所有API都有明确的验收标准
- ✅ 性能要求明确（响应时间、节点数限制）
- ✅ 安全性有保障（JWT认证、权限控制）

*更新时间: 2025-12-10*

